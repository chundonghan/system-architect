## 第1章 计算机组成与体系结构 ##
### 1.1 计算机系统组成 ###
> 计算机系统由`硬件`和`软件`组成  

图1-1 计算机各功能部件之间的合作关系  
![计算机各功能部件之间的合作关系图](https://raw.githubusercontent.com/chundonghan/system-architect/master/img/ch1_1.png)

#### 1.1.1 硬件组成 ####
1. 控制器  
	> `控制器`是分析和执行指令的部件,也是统一指挥并控制计算机各部件协调工作的中心部件,所依据的是机器指令.其组成:  
	> 1. `程序计数器PC`: 存储下一条要执行指令的地址  
	> 2. `指令寄存器IR`: 存储即将执行的指令  
	> 3. `指令译码器ID`: 对指令中操作码字段进行分析解释  
	> 4. `时序部件`: 提供时序控制信号  
2. 运算器  
	> `运算器`也称为`算术逻辑单元(ALU)`,其主要功能是在控制器的控制下完成各种算术运算和逻辑运算.其组成:  
	> 1. 算术逻辑单元ALU: 数据的算术运算和逻辑运算  
	> 2. 累加寄存器AC: 通用寄存器,为ALU提供一个工作区,用在暂存数据  
	> 3. 数据缓冲寄存器DR: 写内存时,暂存指令或数据  
	> 4. 状态条件寄存器PSW: 存状态标志与控制标志  
3. 主存储器 
	> `主存储器`也称为`内存储器`(内存).存储现场操作的信息与中间结果,包括机器指令和数据.  
4. 辅助存储器  
	> `辅助存储器`也称为`外存储器`(外存).存储需要长期保存的各种信息.  
5. 输入设备  
	> 输入设备的任务是把人们编好的程序和原始数据送到计算机中去,并且将它们转换成计算机内部所能识别和接受的信息方式.按输入信息的形态可分为`字符输入`,`图形输入`,`图像输入`及`语音输入`等.常见的输入设备有键盘,鼠标,扫描仪等.  
6. 输出设备  
	> 输出设备的任务是将计算机的处理结果以人或其他设备所能接受的形式送出计算机.最常用的输出设备是打印机和显示器.有些设备既可以是输入设备也可以是输出设备.如辅助存储器.  
#### 1.1.2 计算机系统结构的分类 ####
1. 存储程序的概念
	> 1. 计算机由运算器,存储器,控制器,输入设备和输出设备五大基本部件组成.  
	> 2. 计算机内部采用二进制来表示指令和数据.  
	> 3. 将编好的程序和原始数据事先存入存储器中,然后再启动计算机工作.  
	> 
	> 通常把符合存储程序概念的计算机统称为`冯诺依曼型计算机`  
	> `非冯诺依曼型计算机`: 数据驱动的数据流计算机,需求驱动的归约计算机和模式匹配驱动的智能计算机等
2. Flynn 分类  
	根据指令流,数据流的多倍性特征对计算机系统进行分类.
	> 1. 指令流: 指机器执行的指令序列
	> 2. 数据流: 指由指令流调用的数据序列,包括输入数据和中间结果  
	#
	> 根据不同的指令流-数据流组织方式,把计算机系统分成四类:  
	> 1. 单指令流单数据流(SISD)  
	> 2. 单指令流多数据流(SIMD)  
	> 3. 多指令流单数据流(MISD)  
	> 4. 多指令流多数据流(MIMD)  
#### 1.1.3 复杂指令集系统与精简指令集系统 ####
1. 复杂指令系统计算机(Complex Instruction Set Computer,CISC)
2. 精简指令系统计算机(Reduced Instruction Set Computer,RISC)
#### 1.1.4 总线 ####
总线是一组能在多个部件**分时共享**的公共信息传送线路.
#  
- 按总线相对CPU或其他芯片的位置可分为`内部总线`和`外部总线`两种.
- 按总线功能来划分可分为`地址总线`,`数据总线`,`控制总线`.
### 1.2 存储器系统 ###
>传统的存储器系统一般分为高速缓冲存储器(Cache),主存,辅存三级.  
>多层级的存储体系之所以能用低投入换来较高的存取速率,得益于`局部性原理`.局部性原理是指程序在执行时呈现出局部性规律,即在一较短时间内,程序的执行仅局限于某个部分.程序局部性包括`时间局部性`和`空间局部性`.  
>存储器中数据常用的存取方式有`顺序存取`,`直接存取`,`随机存取`,`相联存取`.  
> 1. 顺序存取: 对数据的访问必须按特定的线性顺序进行.磁带存储器  
> 2. 直接存取: 共享读写装置访问数据,数据块拥有唯一地址标识,读写装置直接通过地址访问数据块.磁盘存储器  
> 3. 随机存取: 存储器的每一个可寻址单元都有自己唯一的地址和读写装置,系统可以在相同的时间对任意一个存储单元的数据进行访问,而与先前的访问序列无关.主存储器
> 4. 相联存取: 随机存取的一种形式,读写取决于其内容,读写时间是一个常数.Cache  
#### 1.2.1 主存储器 ####
主存用来存放计算机运行期间所需要的程序和数据,CPU可直接随机地进行读/写.分类如下:   
1. `随机存取存储器(Random Access Memory)`   
	1. DRAM(Dynamic RAM): 信息随时间逐渐丢失  
	2. SRAM(Static RAM): 信息断电才丢失  
2. `只读存储器(Read Only Memory)`  
	写入内容不因断电而丢失,又称固定存储器,ROM一般用于存放系统程序BIOS(Basic Input Output System)  
存储器编址方式主要有`字编址`和`字节编址`,字节(8位),字(长度可大可小 16位或32位).存储器中每个单元的位数是相同且固定的,称为存储器编址单位.
#### 1.2.2 辅助存储器 ####
图1-2 硬盘信息分布示意图  
![硬盘信息分布示意图](https://raw.githubusercontent.com/chundonghan/system-architect/master/img/ch1_2.png)  
信息分布呈现:`记录面`,`圆柱面`,`磁道`,`扇区`.  
引入柱面的概念是为了提高硬盘的存储速度.文件尽可能存放在同一柱面中,再存入相邻柱面内.扇区存放定长信息块,由操作系统决定,扇区编号从1开始.  
`磁盘访问时间(存取时间) = 寻道时间 + 旋转延迟时间`  
#### 1.2.3 Cache 存储器 ####
Cache的功能是提高CPU数据输入输出的速率.  
Cache通常采用相联存储器(ContentAddressable Memory,CAM).基于`数据内容`进行访问的存储设备.  
1. Cache基本原理  
	使用Cache改善系统性能的依据是`程序的局部性原理`.  
	命中率h,失效率1-h,t1表示cache的周期时间,t2表示内存的周期时间.读操作,使用"Cache+主存储器"的系统的平均周期为t3.则:  
		t3 = t1*h+t2*(1-h)  
	系统的平均存储周期与命中率密切相关.  
2. 映射机制  
	1. 直接映射  
	2. 全相联映射  
	3. 组相联映射  
3. 替换算法  
	1. 随机算法  
	2. 先进先出  
	3. 近期最少使用(LRU)  
4. 写操作  
	1. 写直达  
	2. 写回  
	3. 标记法  
### 1.3 流水线 ###
#### 1.3.1 流水线周期 ####
  `流水线周期`:最耗时的阶段所消耗的时间为流水线周期.  
#### 1.3.2 计算流水线执行时间 ####
`流水线执行时间 = 第一条指令的执行时间 + (n-1)流水线周期`  
实际中,每个阶段时间统一为流水线周期
#### 1.3.3 流水线的吞吐率 ####
流水线的吞吐率(Though Put rate,TP)是指在单位时间内流水线所完成的任务数量或输出的结果数量.  
	TP =n/Tk  
	其中n为任务数,Tk是处理完成n个任务所用的时间.  
	流水线的最大吞吐率为:  
![流水线的最大吞吐率](https://raw.githubusercontent.com/chundonghan/system-architect/master/img/ch1_3.png)  
#### 1.3.4 流水线的加速比 ####
流水线的加速比(speedup ratio)是指完成同样一批任务,不使用流水线所用的时间与使用流水线所用的时间之比.  
![流水线的最大吞吐率](https://raw.githubusercontent.com/chundonghan/system-architect/master/img/ch1_4.png)  


